{% extends "JLMOfficeBundle::layout.html.twig" %}

{% block content %}
<h1>Nouveau syndic</h1>

{% form_theme form 'JLMOfficeBundle:Form:field_row.html.twig' %}

<form action="{{ path('trustee_create') }}" method="post" {{ form_enctype(form) }} class="form-horizontal">
    <fieldset>
    {{ form_widget(form) }}
	<div class="form-actions">
	   <a href="{{ path('trustee') }}" class="btn"><i class="icon-arrow-left"></i> Retour Ã  la liste</a>
	   <button type="submit" class="btn btn-primary"><i class="icon-pencil icon-white"></i> Enregistrer les modifications</button>
	</div>
</fieldset>
{% endblock %}

{% block javascripts %}
<script>
	var addressesCount = '{{ form.addresses | length }}';
    var phonesCount = '{{ form.phones | length }}';
    var emailsCount = '{{ form.emails | length }}';
    
    $(document).ready(function() {
        $('#jlm_modelbundle_trusteetype_addresses + .add').click(function() {
            var addresses = $('#jlm_modelbundle_trusteetype_addresses');
            var newWidget = addresses.attr('data-prototype');
            newWidget = newWidget.replace(/\$\$name\$\$/g, addressesCount);
            addressesCount++;
            var newLi = $('<li></li>').html(newWidget);
            newLi.appendTo($('#jlm_modelbundle_trusteetype_addresses'));
            tah();
            return false;
        });
        $('#jlm_modelbundle_trusteetype_phones + .add').click(function() {
            var phones = $('#jlm_modelbundle_trusteetype_phones');
            var newWidget = phones.attr('data-prototype');
            newWidget = newWidget.replace(/\$\$name\$\$/g, phonesCount);
            phonesCount++;
            var newLi = $('<li></li>').html(newWidget);
            newLi.appendTo($('#jlm_modelbundle_trusteetype_phones'));
            return false;
        });
        $('#jlm_modelbundle_trusteetype_emails + .add').click(function() {
            var emails = $('#jlm_modelbundle_trusteetype_emails');
            var newWidget = emails.attr('data-prototype');
            newWidget = newWidget.replace(/\$\$name\$\$/g, emailsCount);
            emailsCount++;
            var newLi = $('<li></li>').html(newWidget);
            newLi.appendTo($('#jlm_modelbundle_trusteetype_emails'));
            return false;
        });
        tah();
function tah(){
        $('.typeahead').typeahead({
        	source : function(query,process){
    			return $.get('{{ path('test_autocomplete', {query:''}) }}/' + query, 
    					function (data) { return process(data.options);
    			});
            },
            highlighter: function (item) {
                var query = this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&')
                var a = item.split('|');
                return a[0].replace(new RegExp('(' + query + ')', 'ig'), function ($1, match) {
                  return '<strong>' + match + '</strong>'
                })
            },
            updater:function(item) {
            	var a = item.split('|');
    			this.$element.prev().val(a[1]);
    			return a[0];
            }
        });
}
    })
</script>
{% endblock %}