{% extends "JLMModelBundle::layout.html.twig" %}

{% block content %}
<h1>Fiche installation</h1>
{% if entity.stopped %}
<div class="alert alert-danger"><h4>Porte à l'arrêt</h4></div>
{% endif %}

{% if entity.width and entity.height %}{{ entity.width }}x{{ entity.height }}mm</small>{% endif %}</h1>
<div class="row-fluid">
	<div class="span6">
		
		<h4><span class="text-info">{{ entity.type }} - {{ entity.location }}</span>
		<br>{{ entity.street|nl2br }}
		<br>{{ entity.site.address.city}}</h4>
		<hr>
		{% if entity.transmitters|length > 0 %}
		<h5>Types d'emetteurs
		{% if entity.observations %}
		<br><small>{{ entity.observations }}</small>
		{% endif %}</h5>
		<ul>
		{% for transmitter in entity.transmitters %}
			<li><a href="{{ path('jlm_product_product_show',{'id':transmitter.id}) }}">{{ transmitter }}</a></li>
		{% endfor %}
		</ul>
		{% else %}
		<h5>Aucun emetteur</h5s>
		{% endif %}

	</div>
	<div class="span6 well">
	{% if entity.googlemaps%}
	<iframe width="100%" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="{{ entity.mapsUrl }}"></iframe>
		
	{% else %}
	Pas de photo
	{% endif %}
	</div>
</div>

<div class="form-actions">
	<a href="{{ path('site_show', { 'id': entity.site.id }) }}" class="btn">{{ 'arrow-left'|icon }} Retour à la fiche affaire</a>
	<a href="{{ path('door_edit', { 'id': entity.id }) }}" class="btn btn-warning">{{ 'pencil'|icon(true) }} Editer</a>	
</div>
<h2><small>Contrats</small></h2>
{% include 'JLMContractBundle:Contract:list.html.twig' with { 'contracts':contracts } %}
<div class="form-actions">
	<a id="contract-new" href="{{ path('jlm_contract_contract_new', {'door':entity.id}) }}" class="btn btn-success" role="button">{{ 'plus-sign'|icon(true) }} Ajouter un contrat</a>
</div>
{% endblock %}

{% block modals%}
{% for key,contract in contracts %}
	{# include 'JLMContractBundle:Contract:edit.html.twig' with {'entity':contract,'edit_form':form_contractEdits[key] } #}
	{# include 'JLMContractBundle:Contract:stop.html.twig' with {'entity':contract,'form':form_contractStops[key] } #}
{% endfor %}
{% endblock modals%}

{% block javascripts %}
{{ parent() }}
{{ form_javascript(form_contractNew) }}
{% for form in form_contractEdits %}
{{ form_javascript(form) }}
{% endfor %}
{# for form in form_contractStops %}
{{ form_javascript(form) }}
{% endfor #}
{% endblock %}

{% block javascripts_script %}
{{ parent() }}
$("#contract-new").formModal();
$(".contract-edit").formModal();
{% endblock %}