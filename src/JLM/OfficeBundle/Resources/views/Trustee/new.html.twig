{% extends "JLMOfficeBundle::layout.html.twig" %}

{% block content %}
<h1>Nouveau syndic</h1>

{% form_theme form 'JLMOfficeBundle:Form:field_row.html.twig' %}

<form action="{{ path('trustee_create') }}" method="post" {{ form_enctype(form) }} class="form-horizontal">
    <fieldset>
    {{ form_widget(form) }}
	<div class="form-actions">
	   <a href="{{ path('trustee') }}" class="btn"><i class="icon-arrow-left"></i> Retour Ã  la liste</a>
	   <button type="submit" class="btn btn-primary"><i class="icon-pencil icon-white"></i> Enregistrer les modifications</button>
	</div>
</fieldset>
{% endblock %}

{% block javascripts %}
<script>
	var addressesCount = '{{ form.addresses | length }}';
    var phonesCount = '{{ form.phones | length }}';
    var emailsCount = '{{ form.emails | length }}';

    $(document).ready(function() {
        $('#jlm_modelbundle_trusteetype_addresses .add').click(function() {
            elem = $('#jlm_modelbundle_trusteetype_addresses');
            elem.append(elem.attr('data-prototype').replace(/\$\$name\$\$/g, addressesCount));
            addressesCount++;
            tahcity();
            $('#jlm_modelbundle_trusteetype_addresses .remove').click(function() {
    			$(this).parent().parent().remove();
    			return false;
            });
            return false;
        });

        
        $('#jlm_modelbundle_trusteetype_phones .add').click(function() {
        	elem = $('#jlm_modelbundle_trusteetype_phones');
        	elem.append(elem.attr('data-prototype').replace(/\$\$name\$\$/g, phonesCount));
            phonesCount++;
             $('#jlm_modelbundle_trusteetype_phones .remove').click(function() {
    			$(this).parent().parent().remove();
    			return false;
            });
            return false;
        });
        $('#jlm_modelbundle_trusteetype_emails .add').click(function() {
            elem = $('#jlm_modelbundle_trusteetype_emails');
            elem.append(elem.attr('data-prototype').replace(/\$\$name\$\$/g, emailsCount));
            emailsCount++;
            $('#jlm_modelbundle_trusteetype_emails .remove').click(function() {
    			$(this).parent().parent().remove();
    			return false;
            });
            return false;
        });
        
        tahcity();
		function tahcity(){
	        $('.typeahead').typeahead({
	        	source : function(query,process){
	    			return $.get('{{ path('test_autocomplete', {query:''}) }}/' + query, 
	    					function (data) { return process(data.options);
	    			});
	            },
	            highlighter: function (item) {
	                var query = this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&')
	                var a = item.split('|');
	                return a[0].replace(new RegExp('(' + query + ')', 'ig'), function ($1, match) {
	                  return '<strong>' + match + '</strong>'
	                })
	            },
	            updater:function(item) {
	            	var a = item.split('|');
	    			this.$element.prev().val(a[1]);
	    			return a[0];
	            }
	        });
		}
	})
</script>
{% endblock %}